<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NextLynx Tech • Área do Tutor</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {
  --bg-dark: #0f172a;
  --bg-darker: #1e293b;
  --primary: #7c3aed;
  --primary-dark: #4f46e5;
  --success: #22c55e;
  --success-light: #4ade80;
  --text-light: #e2e8f0;
  --text-muted: #94a3b8;
}

body {
  background: linear-gradient(135deg, var(--bg-dark), var(--bg-darker));
  font-family: 'Poppins', sans-serif;
  color: var(--text-light);
  min-height: 100vh;
  margin: 0;
}

/* HEADER */
.header {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  padding: 2.5rem 1rem;
  text-align: center;
  box-shadow: 0 8px 32px rgba(0,0,0,0.5);
}

.header h1 {
  font-weight: 900;
  margin: 0;
  font-size: 2.2rem;
}

.header p {
  margin: 0.5rem 0 0;
  opacity: 0.9;
  font-size: 1rem;
}

/* CONTAINER PRINCIPAL */
.container-main {
  padding: 2rem 1rem;
  max-width: 1200px;
}

/* CARD */
.aulas-card {
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(14px);
  border-radius: 24px;
  padding: 1.8rem;
  box-shadow: 0 20px 60px rgba(0,0,0,0.45);
  border: 1px solid rgba(255,255,255,0.08);
  margin-bottom: 2rem;
}

.aulas-card h4 {
  margin-bottom: 1.5rem;
  font-weight: 700;
  color: #c4b5fd;
}

/* TABELA RESPONSIVA */
.table-responsive {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.table {
  color: var(--text-light);
  min-width: 700px; /* força scroll horizontal em mobile se necessário */
}

.table thead th {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  border: none;
  text-transform: uppercase;
  font-size: 0.85rem;
  letter-spacing: 0.5px;
  padding: 1rem 0.75rem;
}

.table td {
  vertical-align: middle;
  padding: 1rem 0.75rem;
  border-color: rgba(255,255,255,0.08);
}

/* BOTÃO REUNIÃO */
.btn-meet {
  background: linear-gradient(135deg, var(--success), var(--success-light));
  border: none;
  border-radius: 50px;
  padding: 0.6rem 1.5rem;
  font-weight: 600;
  color: white;
  white-space: nowrap;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(34,197,94,0.3);
}

.btn-meet:hover {
  transform: scale(1.06);
  box-shadow: 0 8px 25px rgba(34,197,94,0.5);
}

/* BOTÃO SAIR */
.btn-logout {
  background: linear-gradient(135deg, #ef4444, #f97316);
  border: none;
  border-radius: 50px;
  padding: 0.7rem 2rem;
  font-weight: 600;
  color: white;
  transition: all 0.3s ease;
}

.btn-logout:hover {
  transform: scale(1.06);
  box-shadow: 0 8px 25px rgba(239,68,68,0.4);
}

/* NO AULAS */
.no-aulas {
  text-align: center;
  padding: 4rem 1rem;
  color: var(--text-muted);
  font-size: 1.3rem;
}

/* RESPONSIVIDADE */
@media (max-width: 576px) {
  .header { padding: 2rem 1rem; }
  .header h1 { font-size: 1.8rem; }
  .aulas-card { padding: 1.5rem; }
  .table th, .table td { font-size: 0.9rem; padding: 0.8rem 0.5rem; }
  .btn-meet, .btn-logout { padding: 0.6rem 1.2rem; font-size: 0.95rem; }
  .container-main { padding: 1.5rem 1rem; }
}

@media (max-width: 400px) {
  .btn-meet, .btn-logout { width: 100%; margin-bottom: 0.8rem; }
}






/* Container principal centralizado e com largura máxima */
.container-main {
  max-width: 1400px; /* aumenta se quiseres mais largo em telas grandes */
  margin-left: auto;
  margin-right: auto;
  padding: 0 1rem; /* espaçamento lateral consistente */
}

/* Card das aulas – centralizado e com sombra suave */
.aulas-card {
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(14px);
  border-radius: 24px;
  padding: 2rem;
  box-shadow: 0 20px 60px rgba(0,0,0,0.45);
  border: 1px solid rgba(255,255,255,0.08);
  margin: 0 auto; /* centraliza o card */
  max-width: 100%; /* não ultrapassa a tela */
}

/* Tabela responsiva e centralizada */
.table-responsive {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  margin: 0 auto; /* centraliza a tabela */
}

.table {
  color: var(--text-light);
  width: 100%;
  max-width: 100%; /* evita que fique maior que o card */
  margin: 0 auto;
  border-collapse: separate;
  border-spacing: 0 0.5rem; /* espaçamento entre linhas */
}

.table thead th {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  border: none;
  text-transform: uppercase;
  font-size: 0.9rem;
  letter-spacing: 0.5px;
  padding: 1rem 0.75rem;
  white-space: nowrap; /* evita quebra de texto nos cabeçalhos */
}

.table td {
  vertical-align: middle;
  padding: 1rem 0.75rem;
  border-color: rgba(255,255,255,0.08);
}

/* Ajustes para telas grandes */
@media (min-width: 992px) {
  .aulas-card {
    padding: 2.5rem 3rem;
  }
  .table th, .table td {
    font-size: 1rem;
    padding: 1.2rem 1rem;
  }
}

/* Ajustes para telas pequenas (celular) */
@media (max-width: 576px) {
  .header {
    padding: 1.8rem 1rem;
  }
  .header h1 {
    font-size: 1.8rem;
  }
  .aulas-card {
    padding: 1.5rem;
  }
  .table th, .table td {
    font-size: 0.85rem;
    padding: 0.8rem 0.5rem;
  }
  .btn-meet, .btn-logout {
    width: 100%;
    margin-bottom: 0.8rem;
    padding: 0.7rem 1rem;
    font-size: 0.95rem;
  }
}
</style>
</head>

<body>

<!-- HEADER -->
<header class="header">
  <div class="container">
    <h1>Área do Tutor</h1>
    <p>Painel de aulas agendadas</p>
  </div>
</header>

<!-- MAIN -->
<main class="container-main">
  <div class="text-center mb-5">
    <h2 id="mentor-name" class="fw-bold text-white"></h2>
    <p class="opacity-75">Aulas visíveis apenas para ti</p>
  </div>

  <div class="aulas-card">
    <h4 class="text-center">
      <i class="fas fa-calendar-check me-2"></i>
      Minhas Aulas Agendadas
    </h4>

    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead>
          <tr>
            <th>Data</th>
            <th>Hora</th>
            <th>Aluno</th>
            <th>Matéria</th>
            <th>Reunião</th>
          </tr>
        </thead>
        <tbody id="aulas-body"></tbody>
      </table>
    </div>

    <div id="no-aulas-msg" class="no-aulas d-none">
      <i class="fas fa-calendar-times fa-3x mb-3"></i><br>
      Ainda não tens aulas agendadas.
    </div>

    <div class="text-center mt-4">
      <button id="logout-btn" class="btn btn-logout">
        <i class="fas fa-sign-out-alt me-2"></i>
        Sair
      </button>
    </div>
  </div>
</main>

<script>
const supabaseClient = supabase.createClient(
  'https://qgbblhwojxuknlhkeusy.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnYmJsaHdvanh1a25saGtldXN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5NTc1NjYsImV4cCI6MjA3ODUzMzU2Nn0.YpI8xjMqpwJSjHnrvOHfABnyMeIfxsLGJNeXrFoB3p0'
);

/* =========================
   PROTEÇÃO DA PÁGINA + NOME DO TUTOR
========================= */
(async () => {
  const { data: { session } } = await supabaseClient.auth.getSession();

  // Se não estiver logado → redireciona para login
  if (!session) {
    window.location.href = 'login.html'; // ou o nome da tua página de login
    return;
  }

  // Nome do tutor baseado no email
  const nomeTutor = session.user.email.split('@')[0];
  document.getElementById('mentor-name').innerText = 
    `Mentor ${nomeTutor.charAt(0).toUpperCase() + nomeTutor.slice(1)}`;

  carregarAulas();
})();

/* =========================
   LOGOUT
========================= */
document.getElementById('logout-btn').addEventListener('click', async () => {
  await supabaseClient.auth.signOut();
  window.location.href = 'login.html';
});

/* =========================
   CARREGAR AULAS DO TUTOR LOGADO
========================= */
async function carregarAulas() {
  const { data: { user } } = await supabaseClient.auth.getUser();
  if (!user) return;

  const { data, error } = await supabaseClient
    .from('aulas_agendadas')
    .select('*')
    .eq('mentor_id', user.id)
    .order('data', { ascending: true });

  const tbody = document.getElementById('aulas-body');
  const noAulas = document.getElementById('no-aulas-msg');

  tbody.innerHTML = '';

  if (error || !data || data.length === 0) {
    noAulas.classList.remove('d-none');
    return;
  }

  noAulas.classList.add('d-none');

  data.forEach(aula => {
    const dataFormatada = new Date(aula.data).toLocaleDateString('pt-MZ');

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${dataFormatada}</td>
      <td>${aula.hora}</td>
      <td>${aula.aluno_nome}</td>
      <td>${aula.materia}</td>
      <td>
        <a href="${aula.link_reuniao}" target="_blank" class="btn btn-meet">
          <i class="fas fa-video me-2"></i> Entrar
        </a>
      </td>
    `;
    tbody.appendChild(tr);
  });
}
</script>
</body>
</html>